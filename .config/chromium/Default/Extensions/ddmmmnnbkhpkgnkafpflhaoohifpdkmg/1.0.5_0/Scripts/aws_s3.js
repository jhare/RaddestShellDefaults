function AWSs3(_1,_2){this.accessKeyId=_1;this.secretKey=_2;};AWSs3.prototype={DEFEAT_CACHE:false,DEFAULT_ACL:"public-read",DEFAULT_CONTENT_TYPE:"text/plain",DEBUG:false,SUBDOMAINABLE:new RegExp("^[a-z0-9]+(.[a-z0-9]+)*$"),ListBuckets:function(cb,_3){return this.httpClient({method:"GET",resource:"/",load:cb,error:_3});},GetFolder:function(_4,_5,cb,_6){return this.httpClient({method:"GET",bucket:_4,params:_5,load:cb,error:_6});},GetFileURL:function(_7,_8){var _9="s3.amazonaws.com";var _a=Math.floor(new Date().valueOf()/1000)+300;var s="GET\n\n\n"+_a+"\n/"+_7+"/"+_8;var _b=b64_hmac_sha1(this.secretKey,s);return "http://"+_9+"/"+_7+"/"+_8+"?AWSAccessKeyId="+encodeURIComponent(this.accessKeyId)+"&Expires="+_a+"&Signature="+encodeURIComponent(_b);},GetFile:function(_c,_d,cb,_e){return this.httpClient({method:"GET",bucket:_c,key:_d,load:cb,error:_e});},GetFileMetadata:function(_f,key,cb,_10){return this.httpClient({method:"HEAD",bucket:_f,key:key,load:cb,error:_10});},SaveFile:function(_11,key,_12,_13,cb,_14,_15){if(!_13.content_type){_13.content_type=this.DEFAULT_CONTENT_TYPE;}if(!_13.acl){_13.acl=this.DEFAULT_ACL;}if(!_13.content_disposition){_13.content_disposition="";}return this.httpClient({method:"PUT",bucket:_11,key:key,file:_12,content:_12,content_type:_13.content_type,content_disposition:_13.content_disposition,meta:_13.meta,acl:_13.acl,load:cb,error:_14,progress:_15});},UpdateMetadata:function(_16,key,_17,cb,_18,_19){if(!_17.content_type){_17.content_type=this.DEFAULT_CONTENT_TYPE;}if(!_17.acl){_17.acl=this.DEFAULT_ACL;}if(!_17.content_disposition){_17.content_disposition="";}return this.httpClient({method:"PUT",bucket:_16,key:key,replace:true,content_type:_17.content_type,content_disposition:_17.content_disposition,meta:_17.meta,acl:_17.acl,load:cb,error:_18,progress:_19});},CreateBucket:function(_1a,acl,_1b,cb,_1c){var _1d;if(_1b&&_1b!="US"){_1d="<CreateBucketConfiguration>\n"+"<LocationConstraint>"+_1b+"</LocationConstraint>\n"+"</CreateBucketConfiguration>\n";}return this.httpClient({acl:acl,method:"PUT",bucket:_1a,content:_1d,content_type:"text/xml; charset=UTF-8",load:cb,error:_1c});},DeleteBucket:function(_1e,cb,_1f){return this.httpClient({method:"DELETE",bucket:_1e,load:cb,error:_1f});},DeleteFile:function(_20,key,cb,_21){return this.httpClient({method:"DELETE",bucket:_20,key:key,load:cb,error:_21});},httpClient:function(_22){if(_22.resource){var _23="s3.amazonaws.com";var _24=_22.resource;var _25=_22.resource;}else{if(!_22.bucket||_22.bucket.match(this.SUBDOMAINABLE)){var _23=_22.bucket+".s3.amazonaws.com";var _24="/"+(_22.key||"");}else{var _23="s3.amazonaws.com";var _24="/"+_22.bucket+"/"+(_22.key||"");}var _25="/"+_22.bucket+"/"+(_22.key||"");}var _26=this;if(this.DEFEAT_CACHE&&(_22.method=="GET"||_22.method=="HEAD")){if(!_22.params){_22.params={};}_22.params["___"]=new Date().getTime();}var qs=(_22.params)?"?"+queryString(_22.params):"";var url="http://"+_23+_24+qs;var _27={};if(!_22.content_type&&_22.method=="PUT"){_22.content_type=this.DEFAULT_CONTENT_TYPE;}if(_22.content_type){_27["Content-Type"]=_22.content_type;}else{_22.content_type="";}if(_22.content_disposition&&_22.content_disposition.length>0){_27["Content-Disposition"]=_22.content_disposition;}var _28=(new Date()).toUTCString();_27["x-amz-date"]=_28;var _29=_22.content;var _2a="";if(_22.acl){_27["x-amz-acl"]=_22.acl;_2a="x-amz-acl:"+_22.acl+"\n";}if(_22.replace){var _2b="/"+_22.bucket+"/"+_22.key;_27["x-amz-copy-source"]=_2b;_2a+="x-amz-copy-source:"+_2b+"\n";}_2a+="x-amz-date:"+_28+"\n";var _2c="";if(_22.meta){var _2d=new Array();for(k in _22.meta){_2d.push(k);}_2d.sort();for(var k in _2d){_27["x-amz-meta-"+_2d[k].toString().toLowerCase()]=_22.meta[_2d[k]].toString();_2c+="x-amz-meta-"+_2d[k].toString().toLowerCase()+":"+_22.meta[_2d[k]].toString()+"\n";}}if(_22.replace){_27["x-amz-metadata-directive"]="REPLACE";_2c+="x-amz-metadata-directive:"+"REPLACE"+"\n";}if(_22["anonymous"]!=true&&this.accessKeyId&&this.secretKey){var s;s=_22.method+"\n";s+="\n";s+=_22.content_type+"\n";s+="\n";s+=_2a;s+=_2c;s+=_25;localStorage["StringToSign"]=s;_27["Authorization"]="AWS "+this.accessKeyId+":"+b64_hmac_sha1(this.secretKey,s);}var req=new XMLHttpRequest();req.open(_22.method,url,true);for(var k in _27){req.setRequestHeader(k,_27[k]);}if(_22.progress){req.upload.addEventListener("progress",_22.progress,false);}req.onreadystatechange=function(){if(req.readyState==4){if(_26.DEBUG){window._lastreq=req;}if((req.status>=400)&&_22.error){return _22.error(req);}else{if(_22.load){return _22.load(req);}}}};req.send(_29);return req;}};function queryString(_2e){var l=[];for(k in _2e){l.push(k+"="+encodeURIComponent(_2e[k]));}return l.join("&");};