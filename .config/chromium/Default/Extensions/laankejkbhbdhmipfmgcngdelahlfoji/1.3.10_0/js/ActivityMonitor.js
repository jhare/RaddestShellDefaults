/**
 * Functions for monitoring mouse and keyboard activity
 *
 * @author              Warren Benedetto <warren@transfusionmedia.com>
 * @since               January 16, 2010
 * @version             1.0.0
 */function ActivityMonitor_tick(){ActivityMonitor.elapsedTime+=ActivityMonitor.interval,ActivityMonitor.isMaxInactiveTimeExceeded()&&ActivityMonitor.showOverlay("away")}var ActivityMonitor=function(){return{timer:null,interval:10,elapsedTime:0,maxInactiveTime:300,isOverlayActive:!1,isBlockable:!1,currentTabID:null,currentURL:null,initContentScript:function(){chrome.extension.sendRequest({message:"isBlockable"},function(e){ActivityMonitor.isBlockable=e.isBlockable&&!e.isDisabled,ActivityMonitor.isBlockable===!0&&($("body").prepend(ActivityMonitor.getBlockerHTML()),ActivityMonitor.startTimer(),ActivityMonitor.bindTimerReset("body"),$("body").keydown(function(){ActivityMonitor.isOverlayActive===!0&&(ActivityMonitor.hideOverlay(),event.preventDefault())}),$("#StayFocusd-unblock-link").click(function(){ActivityMonitor.isOverlayActive===!0&&ActivityMonitor.hideOverlay()}),$("iframe").each(function(){ActivityMonitor.bindTimerReset($(this).contents().find("body"))}))})},bindTimerReset:function(e){e&&($(e).mousedown(function(){ActivityMonitor.resetTimer()}),$(e).mousemove(function(){ActivityMonitor.resetTimer()}),$(e).keypress(function(){ActivityMonitor.resetTimer()}))},handleContentScriptRequest:function(e,t){var n={};switch(e.message){case"isBlockable":n={isBlockable:StayFocusd.isBlockable(t.tab.url),isDisabled:StayFocusd.isActivityMonitorDisabled()};break;case"stopCountdown":n={countdownStopped:clearInterval(StayFocusd.timer)};break;case"startCountdown":n={countdownStarted:null};break;default:n=null}return n},initBackgroundScript:function(){chrome.tabs.onSelectionChanged.addListener(function(e,t){chrome.tabs.getSelected(null,function(e){e!==undefined&&(ActivityMonitor.currentTabID!=null&&chrome.tabs.sendRequest(ActivityMonitor.currentTabID,{message:"stopTimer"}),ActivityMonitor.currentTabID=e.id,ActivityMonitor.currentURL=e.url,chrome.tabs.sendRequest(ActivityMonitor.currentTabID,{message:"resetTimer"}),chrome.tabs.sendRequest(ActivityMonitor.currentTabID,{message:"hideOverlay"}),StayFocusd.isBlockable(ActivityMonitor.currentURL)&&chrome.tabs.sendRequest(ActivityMonitor.currentTabID,{message:"startTimer"}))})}),chrome.extension.onRequest.addListener(function(e,t,n){var r=ActivityMonitor.handleContentScriptRequest(e,t);r!==null&&n(r)})},handleBackgroundScriptRequest:function(e,t){var n={};switch(e.message){case"stopTimer":n={timerStopped:ActivityMonitor.stopTimer()};break;case"startTimer":n={timerStarted:ActivityMonitor.startTimer()};break;case"resetTimer":n={timerReset:ActivityMonitor.resetTimer()};break;case"hideOverlay":n={overlayHidden:ActivityMonitor.hideOverlay()};break;case"showOverlay":n={overlayShown:ActivityMonitor.showOverlay(e.overlayType)};break;case"getReferrer":n={referrer:document.referrer};break;case"killPage":top.location.href=e.redirectURL+"?content",n={killed:!0};break;default:n=null}return n},startTimer:function(){clearInterval(this.timer),this.timer=setInterval(ActivityMonitor_tick,ActivityMonitor.interval*1e3)},stopTimer:function(){clearInterval(this.timer)},resetTimer:function(){this.elapsedTime=0},isMaxInactiveTimeExceeded:function(){return this.elapsedTime>=this.maxInactiveTime},showOverlay:function(e){$("embed").addClass("StayFocusd-hidden"),$("object").addClass("StayFocusd-hidden"),$("applet").addClass("StayFocusd-hidden"),$("#StayFocusd-overlayHeader").html(chrome.i18n.getMessage("activityMonitorOverlayHeader")),$("#StayFocusd-overlayBody").html(chrome.i18n.getMessage("activityMonitorOverlayBody")),$("#StayFocusd-still-there").css("top",$(window).scrollTop()+"px"),$("#StayFocusd-still-there").removeClass("inactive").addClass("active"),this.isOverlayActive=!0,this.stopTimer(),chrome.extension.sendRequest({message:"stopCountdown"})},hideOverlay:function(){this.isOverlayActive===!0&&($("#StayFocusd-still-there").removeClass("active").addClass("inactive"),$("embed").removeClass("StayFocusd-hidden"),$("object").removeClass("StayFocusd-hidden"),$("applet").removeClass("StayFocusd-hidden"),this.isOverlayActive=!1,this.resetTimer(),this.startTimer(),chrome.extension.sendRequest({message:"startCountdown"}))},getBlockerHTML:function(){var e='<link rel="stylesheet" href="'+chrome.extension.getURL("css/content.css")+'" type="text/css" />';return e+='<div id="StayFocusd-still-there" class="inactive">',e+="<div>",e+='<img src="'+chrome.extension.getURL("img/logo_full.png")+'" title="StayFocusd" alt="StayFocusd" class="StayFocusd-smartBombed" />',e+="</div>",e+='<h1 id="StayFocusd-overlayHeader"></h1>',e+='<p id="StayFocusd-overlayBody"></p>',e+="<p>",e+="<b>"+chrome.i18n.getMessage("activityMonitorOverlayLink1")+' <a href="#" id="StayFocusd-unblock-link" title="'+chrome.i18n.getMessage("activityMonitorOverlayLink4")+'">'+chrome.i18n.getMessage("activityMonitorOverlayLink2")+"</a> "+chrome.i18n.getMessage("activityMonitorOverlayLink3")+"</b>",e+="</p>",e+="</div>",e}}}();