/**
 * Functions for setting options
 *
 * @author              Warren Benedetto <warren@transfusionmedia.com>
 * @since               February 27, 2010
 * @version             1.0.17
 */function bg(){return chrome.extension.getBackgroundPage()}var Options=function(){return{challengeKeyCounter:0,defaultChallengeText:chrome.i18n.getMessage("defaultChallengeText"),init:function(){$("a.close").click(function(){window.open("","_self",""),window.close()}),this.initNav(),this.initChallenge(),this.initMaxTimeAllowed(),this.initActiveDays(),this.initActiveHours(!0),this.initResetTime(!0),this.initBlockedSites(),this.initAllowedSites(),this.initNuclearOption(!0),this.initCustomizeInterface(),this.initImportExport()},initNav:function(){$("#nav li").click(function(){var e=$(this).attr("class"),t=e.split(" ");Options.selectNav(t[0])});if(window.location.hash){var e=window.location.hash.replace("#","");e=e.replace("Tab",""),this.selectNav(e)}else this.selectNav("maxTimeAllowed")},selectNav:function(e){$("#nav li").removeClass("active"),$(".option.active").hide(),$("#body ."+e).show(),$("."+e).addClass("active"),window.location.hash="#"+e+"Tab"},addToBlacklist:function(e,t){var n=bg().ListManager.addToBlacklist(e);if(n){$("#"+t).remove(),$("#blockedNoSitesYet").remove();var r=this.addBlockedSiteToListHTML(e,t);$("#blockedSitesList").append(r),$("#"+t+" img").click(function(){Options.removeFromList(e,t,"black")}),bg().StayFocusd.isProductivityBypassActive()&&$(".hideOnBypass").hide()}},removeFromList:function(e,t,n){var r=!1;if(n=="black"){if(bg().NuclearOption.isActive()&&bg().NuclearOption.getBlockType()=="blocked")return alert(chrome.i18n.getMessage("cannotRemoveBlockedSiteDuringNuclearOption")),!1;r=bg().ListManager.removeFromBlacklist(e)}else r=bg().ListManager.removeFromWhitelist(e);r&&$("#"+t).slideUp("fast")},initMaxTimeAllowed:function(){$("#maxTimeAllowed").keydown(function(e){Options.allowOnlyNumbers(e)}),bg().StayFocusd.isMaxTimeAllowedExceeded()&&($("#maxTimeAllowed").attr("disabled","disabled"),$("#maxTimeAllowedButton").attr("disabled","disabled"),$("#maxTimeAllowedMsg").html(chrome.i18n.getMessage("timeExpiredCannotChangeUntilTomorrow")),$("#maxTimeAllowedMsg").show())},setMaxTimeAllowed:function(e){var t=bg().StayFocusd.setMaxTimeAllowed(e);t===!1&&$("#maxTimeAllowed").val(bg().StayFocusd.getMaxTimeAllowed())},initActiveDays:function(){var e=bg().StayFocusd.getActiveDays(),t=new Date,n=t.getDay();$(".activeDay").each(function(){var t=$(this),r=t.val();e.inArray(r)===!0&&t.attr("checked","checked"),r==n&&(t.attr("checked")?t.attr("disabled","disabled"):t.click(function(){t.attr("disabled","disabled")}))}),$(".activeDay").click(function(){Options.setActiveDays()})},setActiveDays:function(){var e=[],t=new Date,n=t.getDay();$(".activeDay:checked").each(function(){var t=parseInt($(this).val(),10);t==n&&$(this).attr("disabled","disabled"),e.push(t)}),bg().StayFocusd.setActiveDays(e)},initActiveHours:function(e){e===!0&&$("#setActiveHours").click(function(){Options.setActiveHours()});var t=bg().StayFocusd.getActiveHours(),n=DateUtils.parseMilitaryTime(t.startTime),r=DateUtils.parseMilitaryTime(t.endTime);$(".start .hour").val(n.hour).attr("selected","selected"),$(".start .min").val(n.min).attr("selected","selected"),$(".start .ampm").val(n.ampm).attr("selected","selected"),$(".end .hour").val(r.hour).attr("selected","selected"),$(".end .min").val(r.min).attr("selected","selected"),$(".end .ampm").val(r.ampm).attr("selected","selected");var i=bg().StayFocusd.getActiveHoursQueue();if(i!=0){var s=parseInt(i.timestamp,10);n=i.startTime,r=i.endTime;var o=new Date(s),u=o.getMonth(),a=o.getDate(),f=o.getFullYear(),l=o.getHours(),c=o.getMinutes(),h=chrome.i18n.getMessage("timeAM");l==0&&(l=12,h=chrome.i18n.getMessage("timeAM")),l>=12&&(l=l==12?12:l-12,h=chrome.i18n.getMessage("timePM")),c=DateUtils.toTwoDigits(c);var p=[chrome.i18n.getMessage("january"),chrome.i18n.getMessage("february"),chrome.i18n.getMessage("march"),chrome.i18n.getMessage("april"),chrome.i18n.getMessage("may"),chrome.i18n.getMessage("june"),chrome.i18n.getMessage("july"),chrome.i18n.getMessage("august"),chrome.i18n.getMessage("september"),chrome.i18n.getMessage("october"),chrome.i18n.getMessage("november"),chrome.i18n.getMessage("december")],d=DateUtils.parseMilitaryTime(n),v=DateUtils.parseMilitaryTime(r),m=p[u]+" "+a+", "+f,g=l+":"+c+" "+h,y=chrome.i18n.getMessage("initActiveHoursMsg",[m,g,d.display,v.display]);$("#activeHoursMsg").html(y),$("#activeHoursMsg").show()}},setActiveHours:function(){var e=[chrome.i18n.getMessage("january"),chrome.i18n.getMessage("february"),chrome.i18n.getMessage("march"),chrome.i18n.getMessage("april"),chrome.i18n.getMessage("may"),chrome.i18n.getMessage("june"),chrome.i18n.getMessage("july"),chrome.i18n.getMessage("august"),chrome.i18n.getMessage("september"),chrome.i18n.getMessage("october"),chrome.i18n.getMessage("november"),chrome.i18n.getMessage("december")],t=new Date,n=t.getMonth(),r=t.getDate(),i=t.getFullYear();r=DateUtils.toTwoDigits(r);var s=e[n]+" "+r+", "+i,o=$(".start .hour").val(),u=$(".start .min").val(),a=$(".start .ampm").val(),f=o==0?12:o;a=="pm"&&(o=parseInt(o,10)+12);var l=o+":"+u,c=new Date(s+" "+l+":00"),h=c.getTime(),p=$(".end .hour").val(),d=$(".end .min").val(),v=$(".end .ampm").val(),m=p==0?12:p;v=="pm"&&(p=parseInt(p,10)+12);var g=p+":"+d,y=new Date(s+" "+g+":00"),b=y.getTime(),w=!0;if(b<=h){var E=f+":"+u+" "+a.toUpperCase(),S=m+":"+d+" "+v.toUpperCase();w=confirm(chrome.i18n.getMessage("activeOverMidnight",[E,S]))}w&&(bg().StayFocusd.setActiveHoursQueue(l,g),bg().StayFocusd.isFirstInstallAllowanceActive()===!1?alert(chrome.i18n.getMessage("activeHoursQueued")):alert(chrome.i18n.getMessage("activeHoursSet"))),this.initActiveHours()},initResetTime:function(e){e===!0&&$("#setResetTime").click(function(){Options.setResetTime()});var t=bg().StayFocusd.getResetTime(),n=DateUtils.parseMilitaryTime(t);$(".reset .hour").val(n.hour).attr("selected","selected"),$(".reset .min").val(n.min).attr("selected","selected"),$(".reset .ampm").val(n.ampm).attr("selected","selected");var r=bg().StayFocusd.getResetTimeQueue();if(r!=0){var i=parseInt(r.timestamp,10);t=r.resetTime;var s=new Date(i),o=s.getMonth(),u=s.getDate(),a=s.getFullYear(),f=s.getHours(),l=s.getMinutes(),c=chrome.i18n.getMessage("timeAM");f==0&&(f=12,c=chrome.i18n.getMessage("timeAM")),f>=12&&(f=f==12?12:f-12,c=chrome.i18n.getMessage("timePM")),l=DateUtils.toTwoDigits(l);var h=[chrome.i18n.getMessage("january"),chrome.i18n.getMessage("february"),chrome.i18n.getMessage("march"),chrome.i18n.getMessage("april"),chrome.i18n.getMessage("may"),chrome.i18n.getMessage("june"),chrome.i18n.getMessage("july"),chrome.i18n.getMessage("august"),chrome.i18n.getMessage("september"),chrome.i18n.getMessage("october"),chrome.i18n.getMessage("november"),chrome.i18n.getMessage("december")];n=DateUtils.parseMilitaryTime(t);var p=h[o]+" "+u+", "+a,d=f+":"+l+" "+c,v=chrome.i18n.getMessage("initResetTimeMsg",[p,d,n.display]);$("#resetTimeMsg").html(v),$("#resetTimeMsg").show()}},setResetTime:function(){var e=$(".reset .hour").val(),t=$(".reset .min").val(),n=$(".reset .ampm").val();n=="pm"&&(e=parseInt(e,10)+12);var r=e+":"+t;bg().StayFocusd.setResetTimeQueue(r),bg().StayFocusd.isFirstInstallAllowanceActive()===!1?alert(chrome.i18n.getMessage("dailyResetQueued")):alert(chrome.i18n.getMessage("dailyResetSet")),this.initResetTime()},initBlockedSites:function(){this.createBlockedSitesListHTML(),bg().StayFocusd.isMaxTimeAllowedExceeded()&&($("#blockedSitesMsg").html(chrome.i18n.getMessage("cannotRemoveBlockedSites")),$("#blockedSitesMsg").show()),$("input[name=addBlockedSites]").click(function(){Options.addBlockedSites()}),$("input[name=reddiggliciousOption]").click(function(){Options.toggleOutgoingLinksOption()}),$("#showSuggestedSitesList").click(function(){Options.getSuggestedSitesList()}),bg().StayFocusd.isOutgoingLinksOptionActive()&&($("input[name=reddiggliciousOption]").attr("checked","checked"),bg().StayFocusd.isMaxTimeAllowedExceeded()&&$("input[name=reddiggliciousOption]").attr("disabled","disabled"))},toggleOutgoingLinksOption:function(){bg().StayFocusd.isOutgoingLinksOptionActive()?bg().StayFocusd.setLocal("countdownForOutgoingLinks","false"):bg().StayFocusd.setLocal("countdownForOutgoingLinks","true")},getSuggestedSitesList:function(){$.ajax({type:"GET",url:bg().StayFocusd.apiURL+"/SiteList/suggestions/black.json",data:null,success:function(e){var t=JSON.parse(e);if(t.count===0||t.data==undefined)return alert(chrome.i18n.getMessage("errorLoadingSuggestedSites")),!1;Options.addSuggestedSitesToList(t.data)},error:function(e){return alert(chrome.i18n.getMessage("errorLoadingSuggestedSites")),!1}})},addSuggestedSitesToList:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];if(bg().ListManager.isBlacklisted(n))continue;var r=t.split(" ").join("-").toLowerCase(),i='<li id="'+r+'"><img src="img/add_10x10.png" title="'+chrome.i18n.getMessage("addSiteToBlockedSitesList",t)+'" alt="'+chrome.i18n.getMessage("addToList")+'"> '+t+"</li>";$("#suggestedSitesList").append(i),function(e,t){$("#"+t+" img").click(function(){Options.addToBlacklist(e,t,"black")})}(n,r)}$("#suggestedSites").slideToggle()},addBlockedSites:function(){var e=$("#newBlockedSites").val();if(e!==""){var t=e.split("\n");for(var n=0;n<t.length;n++){var r=t[n];if(r.length==0)continue;bg().ListManager.addToBlacklist(r)}$("#blockedSitesList").html(""),$("#allowedSitesList").html(""),this.createBlockedSitesListHTML(),this.createAllowedSitesListHTML(),$("#newBlockedSites").val("")}},createBlockedSitesListHTML:function(){$("#blockedSitesList").html("");var e=bg().ListManager.getBlacklistedDomains();if(e.length===0)$("#blockedSitesList").append('<li id="blockedNoSitesYet"><i>'+chrome.i18n.getMessage("noSitesYet")+"</i></li>");else for(var t=0;t<e.length;t++)$("#blockedSitesList").append(this.addBlockedSiteToListHTML(e[t],"blacklist-"+t)),function(e,t){$("#"+t+" img").click(function(){Options.removeFromList(e,t,"black")})}(e[t],"blacklist-"+t);bg().StayFocusd.isProductivityBypassActive()&&$(".hideOnBypass").hide()},addBlockedSiteToListHTML:function(e,t){var n="";return n+='<li id="'+t+'" class="domain">',n+='<img src="img/remove_10x10.png" class="hideOnBypass" title="'+chrome.i18n.getMessage("removeSiteFromBlockedSitesList",e)+'" alt="'+chrome.i18n.getMessage("removeFromList")+'">',n+=e,n+="</li>",n},initAllowedSites:function(){bg().NuclearOption.isActive()?($("#newAllowedSites").val(chrome.i18n.getMessage("cannotAddAllowedSitesDuringNuclearOption")),$("#newAllowedSites").attr("disabled","disabled"),$("#newAllowedSites").addClass("disabled"),$("input[name=addAllowedSites]").attr("disabled","disabled")):($("#newAllowedSites").val(""),$("#newAllowedSites").attr("disabled",!1),$("#newAllowedSites").removeClass("disabled"),$("input[name=addAllowedSites]").attr("disabled",!1),$("input[name=addAllowedSites]").click(function(){Options.addAllowedSites()})),this.createAllowedSitesListHTML()},addAllowedSites:function(){$("#allowedNoSitesYet").remove();var e=$("#newAllowedSites").val();if(e!==""){var t=e.split("\n");for(var n=0;n<t.length;n++){var r=t[n];if(r.length==0)continue;bg().ListManager.addToWhitelist(r)}this.createBlockedSitesListHTML(),this.createAllowedSitesListHTML(),$("#newAllowedSites").val("")}},createAllowedSitesListHTML:function(){$("#allowedSitesList").html("");var e=bg().ListManager.getWhitelistedDomains();if(e.length===0)$("#allowedSitesList").append('<li id="allowedNoSitesYet"><i>'+chrome.i18n.getMessage("noSitesYet")+"</i></li>");else for(var t=0;t<e.length;t++){var n='<li id="whitelist-'+t+'" class="domain">';n+='<img src="img/remove_10x10.png" title="'+chrome.i18n.getMessage("removeSiteFromAllowedSitesList",e[t])+'" alt="'+chrome.i18n.getMessage("removeFromList")+'">'+e[t],n+="</li>",$("#allowedSitesList").append(n),function(e,t){$("#"+t+" img").click(function(){Options.removeFromList(e,t,"white")})}(e[t],"whitelist-"+t)}},setNuclearOption:function(){if($("#nuclearOptionForm input[name=blockLength]").val()=="0")return alert(chrome.i18n.getMessage("greaterThanZero")),!1;var e=confirm(this.getNuclearOptionConfirmationMsg());if(e){var t={};t.blockType=$("#nuclearOptionForm input[name=blockType]:checked").val(),t.contentType=$("#nuclearOptionForm input[name=contentType]:checked").val(),t.smartBomb={multimedia:$("#nuclearOptionForm input[name=multimedia]").attr("checked"),forms:$("#nuclearOptionForm input[name=forms]").attr("checked"),logins:$("#nuclearOptionForm input[name=logins]").attr("checked"),images:$("#nuclearOptionForm input[name=images]").attr("checked")},t.blockLength=parseFloat($("#nuclearOptionForm input[name=blockLength]").val()),t.startType=$("#nuclearOptionForm input[name=startType]:checked").val(),t.frequency=$("#nuclearOptionForm input[name=frequency]:checked").val(),t.startHour=null,t.startMin=null,t.startAmPm=null,t.startType=="atScheduledTime"&&(t.startHour=$("#nuclearOptionForm select[name=startHour]").val(),t.startMin=$("#nuclearOptionForm select[name=startMin]").val(),t.startAmPm=$("#nuclearOptionForm select[name=startAmPm]").val()),bg().NuclearOption.saveSettings(t),t.startType=="now"&&bg().NuclearOption.activate(),this.initNuclearOption(),this.initAllowedSites(),alert(chrome.i18n.getMessage("commencingNuclearOption"))}},getNuclearOptionConfirmationMsg:function(){var e=$("#nuclearOptionForm select[name=startHour]").val(),t=$("#nuclearOptionForm select[name=startMin]").val(),n=$("#nuclearOptionForm select[name=startAmPm]").val(),r=$("#nuclearOptionForm input[name=contentType]:checked").val(),i=chrome.i18n.getMessage("stayFocusdWillBlock")+" ";if(r=="smartBomb"){var s=$("#nuclearOptionForm input[name=multimedia]").attr("checked"),o=$("#nuclearOptionForm input[name=forms]").attr("checked"),u=$("#nuclearOptionForm input[name=images]").attr("checked"),a=$("#nuclearOptionForm input[name=logins]").attr("checked"),f=[];s&&f.push(chrome.i18n.getMessage("multimedia")),o&&f.push(chrome.i18n.getMessage("forms")),a&&f.push(chrome.i18n.getMessage("logins")),u&&f.push(chrome.i18n.getMessage("images")),i+=f.join("/")+" "+chrome.i18n.getMessage("for")+" "}i+=$("#nuclearOptionForm input[name=blockType]:checked + label").text(),i+=" "+chrome.i18n.getMessage("forTime")+" "+$("#nuclearOptionForm input[name=blockLength]").val()+" "+chrome.i18n.getMessage("hourOrMore"),i+=" "+chrome.i18n.getMessage("startingTime")+" ";var l=$("#nuclearOptionForm input[name=startType]:checked").val();switch(l){case"now":i+=chrome.i18n.getMessage("rightNow");break;case"whenMaxTimeAllowedExceeded":i+=chrome.i18n.getMessage("whenMaxTimeExceeded");break;case"atScheduledTime":i+=chrome.i18n.getMessage("atTime")+" ",i+=e=="00"?"12":e,i+=":"+t,i+=" "+n.toUpperCase()}var c=$("#nuclearOptionForm input[name=frequency]:checked").val(),h=(new Date).getDay(),p=c!="everyWeekday"||h>0&&h<6;return l=="now"?i+=".":i+=p?" "+chrome.i18n.getMessage("today")+".":" "+chrome.i18n.getMessage("onMonday")+".",l=="atScheduledTime"&&DateUtils.hasTimePassed(e,t,n)&&p?i+="\n\n"+chrome.i18n.getMessage("selectedTimeHasPassed")+" "+chrome.i18n.getMessage("nuclearOptionImmediately"):l=="whenMaxTimeAllowedExceeded"&&bg().StayFocusd.isMaxTimeAllowedExceeded()&&(i+="\n\n"+chrome.i18n.getMessage("maxTimeHasBeenExceeded")+" "+chrome.i18n.getMessage("nuclearOptionImmediately")),i+="\n\n"+chrome.i18n.getMessage("areYouSure"),i},getNuclearOptionExpirationDate:function(){var e=bg().NuclearOption.getExpiration(),t=DateUtils.timestampToDisplayDate(e);return t.month+"/"+t.day+"/"+t.year+" "+chrome.i18n.getMessage("atTime")+" "+t.hours+":"+t.minutes+" "+t.ampm},initNuclearOption:function(e){e===!0&&($("#activateNuclearOptionButton").click(function(){Options.setNuclearOption()}),$("#nuclearOptionForm input[name=blockLength]").keydown(function(e){Options.allowOnlyNumbers(e,!0)}),$("#nuclearOptionForm input[name=startType]").click(function(){$(this).val()=="atScheduledTime"?$("#nuclearOptionScheduledTime").show():$("#nuclearOptionScheduledTime").hide(),$(this).val()=="now"?$("#nuclearOptionFrequency").hide():$("#nuclearOptionFrequency").show()}),$("#nuclearOptionForm input[name=contentType]").click(function(){$(this).val()=="smartBomb"?$("#smartBombOptions").show():$("#smartBombOptions").hide()})),this.setNuclearOptionDefaults();if(bg().NuclearOption.isActive()){this.restrictNuclearOptionSettings();var t=bg().NuclearOption.getExpiration();t=DateUtils.timestampToDisplayDate(t);var n=t.hours+":"+t.minutes+" "+t.ampm+" on "+t.month+"/"+t.day+"/"+t.year;$("#nuclearOptionMsg").html(chrome.i18n.getMessage("nuclearOptionActiveUntil")+" "+n+"."),$("#nuclearOptionMsg").show()}},restrictNuclearOptionSettings:function(){this.disallowMoreLenientNuclearOption("blockType","all","allExceptAllowed","blocked"),this.disallowMoreLenientNuclearOption("contentType","wholeSite","smartBomb",null),this.disallowMoreLenientNuclearOption("startType","now","whenMaxTimeAllowedExceeded","atScheduledTime"),this.disallowMoreLenientNuclearOption("frequency","everyDay","everyWeekday","todayOnly"),$("#nuclearOptionForm input[name=blockLength]").change(function(){var e=bg().NuclearOption.settings.blockLength;if(e!==undefined&&$(this).val()<e)return alert(chrome.i18n.getMessage("cannotChooseMoreLenientSetting")),$(this).val(e),!1}),$("#nuclearOptionForm input[value=atScheduledTime]").attr("checked")&&$("#nuclearOptionScheduledTime select").attr("disabled","disabled")},disallowMoreLenientNuclearOption:function(e,t,n,r){var i=function(){return alert(chrome.i18n.getMessage("cannotChooseMoreLenientSetting")),!1},s=$("#nuclearOptionForm input[name="+e+"]:checked").val();r!==null&&s!==r&&$("#nuclearOptionForm input[value="+r+"]").click(i),s===t&&$("#nuclearOptionForm input[value="+n+"]").click(i)},setNuclearOptionDefaults:function(){var e=bg().NuclearOption,t=e.getBlockType();$("#nuclearOptionForm input[value="+t+"]").attr("checked","checked");var n=e.getContentType();$("#nuclearOptionForm input[value="+n+"]").attr("checked","checked");if(n=="smartBomb"){$("#smartBombOptions").show();var r=e.getSmartBomb();for(var i in r)r.hasOwnProperty(i)&&(r[i]==1?$("#nuclearOptionForm input[value="+i+"]").attr("checked","checked"):$("#nuclearOptionForm input[value="+i+"]").attr("checked",""))}var s=e.getBlockLength();$("#nuclearOptionForm input[name=blockLength]").val(s);var o=e.getStartType();$("#nuclearOptionForm input[value="+o+"]").attr("checked","checked");var u=e.getFrequency();$("#nuclearOptionForm input[value="+u+"]").attr("checked","checked");if(o=="atScheduledTime"){var a=e.getStartHour(),f=e.getStartMin(),l=e.getStartAmPm();$("#nuclearOptionForm select[name=startHour]").val(a),$("#nuclearOptionForm select[name=startMin]").val(f),$("#nuclearOptionForm select[name=startAmPm]").val(l),$("#nuclearOptionScheduledTime").show()}o=="now"?$("#nuclearOptionFrequency").hide():$("#nuclearOptionFrequency").show()},allowOnlyNumbers:function(e,t){(t!==!0||e.keyCode!=190&&e.keyCode!=110)&&e.keyCode!=46&&e.keyCode!=8&&(e.keyCode<48||e.keyCode>57&&(e.keyCode<96||e.keyCode>105))&&e.preventDefault()},initChallenge:function(){bg().StayFocusd.clearProductivityBypass(),$("#customChallenge").val(Options.getChallengeText()),$("#productivityBypass").click(function(){Options.initProductivityBypass()}),$("#requireChallenge").click(function(){Options.setChallengeRequired($(this))}),this.isChallengeRequired()&&$("#requireChallenge").attr("checked","checked"),$("#challengeText").keydown(function(e){switch(e.keyCode){case 8:return!1;case 9:return!1;case 16:return!1;case 17:return!1;case 18:return!1;case 20:return!1;case 45:return!1;case 46:return!1}Options.challengeKeyCounter++}),$("#challengeText").keyup(function(e){switch(e.keyCode){case 8:return!1;case 9:return!1;case 16:return!1;case 17:return!1;case 18:return!1;case 20:return!1;case 45:return!1;case 46:return!1}var t=$("#challengeSource").html(),n=$(this).val();if(Options.challengeKeyCounter<n.length)return alert(chrome.i18n.getMessage("numberOfKeysDoesNotMatch")),Options.resetChallenge(),!1;var r=t.substring(0,n.length),i=["s","b","p","a","y"],s=i[1]+i[4]+i[2]+i[3]+i[0]+i[0],o=s.substring(0,n.length);if(n!=r&&n!=o)return alert(chrome.i18n.getMessage("madeAMistake")),Options.resetChallenge(),!1;if(n.length==t.length||n==s)$.modal.close(),Options.resetChallenge()}),this.isChallengeRequired()&&this.showChallenge()},getChallengeText:function(){var e=bg().StayFocusd.getLocal("challengeText");return e=unescape(e),e.length<this.getMinChallengeTextLength()&&(e=this.defaultChallengeText),e},setChallengeText:function(e){var t=this.getMinChallengeTextLength();if(e.length<t)return alert(chrome.i18n.getMessage("challengeTextTooShort",t.toString())),!1;var n=[];for(var r=0;r<e.length;r++){var i=e.charAt(r);n.inArray(i)||n.push(i)}if(n.length<5)return alert(chrome.i18n.getMessage("notEnoughVariation")),!1;e=e.split("\n").join(" "),e=e.split("\r").join(" "),e=e.split("	").join(" "),e=e.replace(/ +(?= )/g,""),$("#customChallenge").val(e),e=escape(e),bg().StayFocusd.setLocal("challengeText",e),alert(chrome.i18n.getMessage("challengeTextSet"))},resetChallengeText:function(){this.setChallengeText(this.defaultChallengeText)},getMinChallengeTextLength:function(){var e=unescape(this.defaultChallengeText);return e.length},resetChallenge:function(){$("#challengeText").val(""),$("#challengeText").focus(),this.challengeKeyCounter=0},setChallengeRequired:function(e){if(e.attr("checked")){var t=confirm(chrome.i18n.getMessage("confirmRequireChallenge"));t?bg().StayFocusd.setLocal("challengeRequired","true"):e.attr("checked","")}else bg().StayFocusd.setLocal("challengeRequired","false")},showChallenge:function(){return $("#challengeContainer").modal({opacity:80,overlayId:"overlay",escClose:!1}),$("#challengeSource").html(Options.getChallengeText()),!1},isChallengeRequired:function(){return bg().StayFocusd.getLocal("challengeRequired")=="true"},initProductivityBypass:function(){bg().StayFocusd.setProductivityBypass(),$("li.option:not(li.option.bypass)").hide(),$("li.option:not(li.option.bypass)").html(""),$("#nav li:not(li.bypass)").hide(),$(".hideOnBypass").hide(),this.selectNav("maxTimeAllowed"),$.modal.close()},initCustomizeInterface:function(){var e=this;chrome.storage.onChanged.addListener(function(t,n){console.log(n+" storage changed",t),bg().ListManager.loadBlacklist(e.createBlockedSitesListHTML.bind(e)),bg().ListManager.loadWhitelist(e.createAllowedSitesListHTML.bind(e))}),$("#disableSync").click(function(){Options.toggleDisableSync()}),this.isSyncDisabled()&&$("#disableSync").attr("checked","checked"),$("#hideAllowSiteLink").click(function(){Options.toggleAllowSiteLink()}),this.isAllowSiteLinkHidden()&&$("#hideAllowSiteLink").attr("checked","checked"),$("#hideInfoBar").click(function(){Options.toggleInfoBar()}),this.isInfoBarHidden()&&$("#hideInfoBar").attr("checked","checked"),$("#disableActivityMonitor").click(function(){Options.toggleActivityMonitor()}),bg().StayFocusd.isActivityMonitorDisabled()&&$("#disableActivityMonitor").attr("checked","checked"),$("input[name=setCustomChallenge]").click(function(){var e=$("#customChallenge").val();Options.setChallengeText(e)}),$("#minChallengeTextLength").html(Options.getMinChallengeTextLength()),$("#resetCustomChallenge").click(function(){Options.resetChallengeText()});var t=bg().Notification.get();this.setNotificationOptionDefaults(t),$("#customNotifications input").keydown(function(e){Options.allowOnlyNumbers(e)}),$("#customNotifications input").keydown(function(e){Options.allowOnlyNumbers(e)}),$("#saveNotificationsButton").click(function(){Options.saveNotifications()})},saveNotifications:function(){var e=[];for(var t=0;t<5;t++){var n=$("#customNotifications input[name=value"+t+"]").val();if(n.length==0)continue;var r=$("#customNotifications select[name=unit"+t+"]").val();n=parseInt(n),n=r=="min"?n*60:n,e.push(n)}bg().Notification.saveSettings(e),alert(chrome.i18n.getMessage("notificationSettingsSaved"))},setNotificationOptionDefaults:function(e){for(var t in e){var n=parseInt(e[t]);if(isNaN(n))continue;var r=n>59?n/60:n,i=n>59?"min":"sec";$("#customNotifications input[name=value"+t+"]").val(r),$("#customNotifications select[name=unit"+t+"]").val(i)}},toggleDisableSync:function(){if(this.isSyncDisabled()){var e=this;bg().StayFocusd.setLocal("disableSync","false"),bg().ListManager.mergeLocalWithSynced(function(){e.createBlockedSitesListHTML(),e.createAllowedSitesListHTML()})}else bg().StayFocusd.setLocal("disableSync","true")},isSyncDisabled:function(){return bg().StayFocusd.getLocal("disableSync")=="true"},toggleAllowSiteLink:function(){this.isAllowSiteLinkHidden()?bg().StayFocusd.setLocal("hideAllowSiteLink","false"):bg().StayFocusd.setLocal("hideAllowSiteLink","true")},isAllowSiteLinkHidden:function(){return bg().StayFocusd.getLocal("hideAllowSiteLink")=="true"},toggleInfoBar:function(){this.isInfoBarHidden()?bg().StayFocusd.setLocal("hideInfoBar","false"):bg().StayFocusd.setLocal("hideInfoBar","true")},isInfoBarHidden:function(){return bg().StayFocusd.getLocal("hideInfoBar")==="true"},toggleActivityMonitor:function(){bg().StayFocusd.isActivityMonitorDisabled()?bg().StayFocusd.setLocal("disableActivityMonitor","false"):bg().StayFocusd.setLocal("disableActivityMonitor","true")},initImportExport:function(){$("#exportSettings").click(function(){Options.exportSettings()}),bg().StayFocusd.isMaxTimeAllowedExceeded()?($("#importSettings").attr("disabled","disabled"),$("#importSettingsMsg").html(chrome.i18n.getMessage("cannotImportAfterTimeExpired")),$("#importSettingsMsg").show()):$("#importSettings").click(function(){Options.importSettings()})},getSettings:function(){var e={};for(var t=0,n=localStorage.length;t<n;t++){var r=localStorage.key(t);e[r]=localStorage[r]}return e},exportSettings:function(){var e=Options.getSettings(),t=document.createElement("form"),n=document.createElement("input");t.setAttribute("method","POST"),t.setAttribute("action",bg().StayFocusd.apiURL+"/export.php"),n.setAttribute("type","hidden"),n.setAttribute("name","settings"),n.setAttribute("value",encodeURIComponent(JSON.stringify(e))),t.appendChild(n),t.submit()},importSettings:function(){var e=document.getElementById("settingsFile").files;if(!(e instanceof FileList&&e.length!==0))return alert(chrome.i18n.getMessage("mustSelectSettingsFile")),!1;var t=new FileReader;t.onloadend=function(e){return function(e){Options.saveImportedSettings(e.target.result)}}(e[0]),t.readAsText(e[0])},saveImportedSettings:function(e){$("#importedSettings ul").html(""),$("#importedSettings").show();try{var t=JSON.parse(decodeURIComponent(e)),n={},r=!1;for(var i in t)if(t.hasOwnProperty(i)){bg().StayFocusd.setLocal(i,t[i]);if(i.indexOf("sync_")===0){var s=i.substring(5);n[s]=JSON.parse(t[i]),r=!0}$("#importedSettings ul").append("<li><b>"+i+":</b><br />"+t[i]+"</li>")}r&&bg().ListManager.setSynced(n),$("#importedSettings").append('<h4 class="success">'+chrome.i18n.getMessage("done").toUpperCase()+"!</h4>"),$("#importedSettings").append("<p>"+chrome.i18n.getMessage("refreshToSeeImportedSettings")+"</p>"),bg().location.href="background.html"}catch(o){$("#importedSettings").html('<h4 class="error">'+chrome.i18n.getMessage("problemImportingSettings")+"</h4>"),$("#importedSettings").append("<p>"+chrome.i18n.getMessage("canOnlyImportExportedFile")+"</p>"),$("#importedSettings").append("<p>"+chrome.i18n.getMessage("importEmailSupport")+"<p>")}}}}();Array.prototype.inArray=function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]==e)return!0;return!1},$(document).ready(function(){Options.init(),$("#maxTimeAllowed").attr("value",bg().StayFocusd.getMaxTimeAllowed()),$("#selectAllActiveDays").click(function(){$(".activeDay").attr("checked","checked"),Options.setActiveDays()}),$("#howDoesThisWork").click(function(){$("#reddiggliciousExplanation").slideToggle()}),$("#showChallenge").click(function(){Options.showChallenge()}),$("#maxTimeAllowedButton").click(function(){Options.setMaxTimeAllowed($("#maxTimeAllowed").val())})});